# –ò–Ω—Ç—Ä—É–∑–∏–≤–Ω–æ—Å—Ç—å

üõë –ü—Ä–∏—Å—Ç—É–ø–∞–π—Ç–µ –∫ —ç—Ç–æ–π —á–∞—Å—Ç–∏ **—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏** –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞–ø–∏—Å–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π `std::function<void()>`.

---

–ü–æ–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –≤ —ç–∫–∑–µ–∫—É—Ç–æ—Ä ‚Äì —ç—Ç–æ (–≤ –æ–±—â–µ–º —Å–ª—É—á–∞–µ) –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∞–ª–ª–æ–∫–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–ª—è –ª—è–º–±–¥—ã (–Ω–∞–∑–æ–≤–µ–º –µ–≥–æ _—Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∑–∞–¥–∞—á–∏_) –¥–ª—è type erasure –≤–Ω—É—Ç—Ä–∏ `fu2::unique_function`.

![Non-intrusive tasks](https://gitlab.com/Lipovsky/concurrency-course-media/-/raw/main/tasks/executors/non-intrusive-tasks.png)

–ü—Ä–∏ —ç—Ç–æ–º –≥–ª–∞–≤–Ω—ã–º "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º" —ç–∫–∑–µ–∫—É—Ç–æ—Ä–æ–≤ ‚Äì stackful —Ñ–∞–π–±–µ—Ä–∞–º, stackless –∫–æ—Ä—É—Ç–∏–Ω–∞–º, —Ñ—å—é—á–∞–º ‚Äì –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∞–ª–ª–æ–∫–∞—Ü–∏–∏ –ø—Ä–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è: –æ–Ω–∏ –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Å–≤–æ–∏—Ö –∑–∞–¥–∞—á —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ. 

## –ò–Ω—Ç—Ä—É–∑–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏

–ò–∑–±–∞–≤—å—Ç–µ—Å—å –æ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∞–ª–ª–æ–∫–∞—Ü–∏–π –ø–∞–º—è—Ç–∏ –≤ —ç–∫–∑–µ–∫—É—Ç–æ—Ä–∞—Ö, —Å–¥–µ–ª–∞–≤ –∑–∞–¥–∞—á–∏ _–∏–Ω—Ç—Ä—É–∑–∏–≤–Ω—ã–º–∏_:

```cpp
// exe/executors/task.hpp

struct ITask {
  virtual ~ITask() = default;
  
  virtual void Run() noexcept = 0;
};
```

–ó–∞ —ç—Ç–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –º–æ–∂–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è
- –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ `Fiber`
- awaiter –¥–ª—è stackless –∫–æ—Ä—É—Ç–∏–Ω—ã
- —Å–ª—É–∂–µ–±–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ª—è–º–±–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Å–≤–æ–±–æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ `Submit`

–ó–∞–¥–∞—á–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —É–∫–ª–∞–¥—ã–≤–∞—Ç—å—Å—è –≤ –æ—á–µ—Ä–µ–¥–∏, —Ç–∞–∫ —á—Ç–æ –≤—Å—Ç—Ä–æ–∏–º –≤ –Ω–∏—Ö —É–∫–∞–∑–∞—Ç–µ–ª—å:

```cpp
// exe/executors/task.hpp

struct TaskBase : ITask, wheels::IntrusiveForwardListNode<TaskBase> {
  //
};
```

–ú–µ—Ç–æ–¥ `Submit` —É `IExecutor` –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å `TaskBase*`:

```cpp
// exe/executors/executor.hpp

struct IExecutor {
  virtual ~IExecutor() = default;
  
  virtual void Submit(TaskBase* task) = 0;
};
```
–ò—Ç–æ–≥–æ, –≤ –ø–∞–º—è—Ç–∏ –≤—ã—Å—Ç—Ä–æ–∏—Ç—Å—è —Å–ª–µ–¥—É—é—â–∞—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:

![Intrusive tasks](https://gitlab.com/Lipovsky/concurrency-course-media/-/raw/main/tasks/executors/intrusive-tasks.png)


- –§–∞–π–±–µ—Ä—ã, –∫–æ—Ä—É—Ç–∏–Ω—ã –∏ —Ñ—å—é—á–∏ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `Submit` —É `IExecutor` –Ω–∞–ø—Ä—è–º—É—é, –∏–∑–±–µ–≥–∞—è –Ω–µ–Ω—É–∂–Ω—ã—Ö –∞–ª–ª–æ–∫–∞—Ü–∏–π,
- –°–≤–æ–±–æ–¥–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `Submit` –±—É–¥–µ—Ç –∞–ª–ª–æ—Ü–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –ª—è–º–±–¥ —Å–ª—É–∂–µ–±–Ω—É—é –∑–∞–¥–∞—á—É-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç —Å–∞–º–æ—É–Ω–∏—á—Ç–æ–∂–∞—Ç—å—Å—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏.

## –ó–∞–¥–∞–Ω–∏–µ

- –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∏–Ω—Ç—Ä—É–∑–∏–≤–Ω—ã–µ —ç–∫–∑–µ–∫—É—Ç–æ—Ä—ã
- –ü–µ—Ä–µ–Ω–µ—Å–∏—Ç–µ –∏—Ö –≤ –∑–∞–¥–∞—á—É [fibers/mutex](/tasks/fibers/mutex) –∏ –∏–∑–±–∞–≤—å—Ç–µ—Å—å –≤ —Ñ–∞–π–±–µ—Ä–∞—Ö –æ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∞–ª–ª–æ–∫–∞—Ü–∏–π –ø–∞–º—è—Ç–∏ –ø—Ä–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
