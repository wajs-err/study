# (Functional) Future

## –ü—Ä–µ—Ä–µ–∫–≤–∏–∑–∏—Ç—ã

- [cond/wait_group](/tasks/cond/wait_group)
- [futures/std](/tasks/futures/std)
- [tasks/executors](/tasks/tasks/executors)

---

–î–æ —ç—Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ –º—ã –ø–∏—Å–∞–ª–∏ concurrency –≤ –∏–º–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–º —Å—Ç–∏–ª–µ, –¥—É–º–∞—è –ø—Ä–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–∞–∫ –ø—Ä–æ —Å–µ—Ä–∏–∏ –º—É—Ç–∞—Ü–∏–π —Ä–∞–∑–¥–µ–ª—è–µ–º–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—è –∏—Ö —Ñ–∞–π–±–µ—Ä–∞–º–∏. 

–í —ç—Ç–æ–π –∑–∞–¥–∞—á–µ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è [—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è](https://www.haskell.org/tutorial/) –º–æ–¥–µ–ª—å –¥–ª—è concurrency –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ—å—é—á –∏ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–æ–≤, –≤ –∫–æ—Ç–æ—Ä–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –∫–∞–∫ –≥—Ä–∞—Ñ—ã —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π.

## `Future`

–í –æ—Å–Ω–æ–≤–µ –º–æ–¥–µ–ª–∏ –ª–µ–∂–∏—Ç –ø–æ–Ω—è—Ç–∏–µ _future_ (–¥–∞–ª–µ–µ - –ø—Ä–æ—Å—Ç–æ _—Ñ—å—é—á–∞_) –∏ –∫–ª–∞—Å—Å `Future<T>`.

`Future<T>` –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –±—É–¥—É—â–∏–π, –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤—ã–π, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏.

–ó–∞ —Ñ—å—é—á–µ–π –º–æ–∂–µ—Ç —Å—Ç–æ—è—Ç—å
- [–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤ –ø—É–ª–µ –ø–æ—Ç–æ–∫–æ–≤](exe/futures/make/submit.hpp),
- [RPC](https://capnproto.org/cxxrpc.html),  
- [IO](https://tokio.rs/tokio/tutorial/io),
- [–æ–∂–∏–¥–∞–Ω–∏–µ –Ω–∞ —Å–µ–º–∞—Ñ–æ—Ä–µ](https://github.com/twitter/util/blob/143adbdf5bc6dc55eddb9248c597eeb11a799094/util-core/src/main/scala/com/twitter/concurrent/AsyncSemaphore.scala#L141),
- [—Ç–∞–π–º–∞—É—Ç](https://gitlab.com/Lipovsky/await/-/blob/c506831d7cce2099ceff5a433e100f460fabf542/examples/futures/main.cpp#L456) –∏ —Ç.–¥.

## `Result`

–§—å—é—á–∞ –º–æ–∂–µ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ –∏–ª–∏ —á—Ç–µ–Ω–∏–µ —Å –¥–∏—Å–∫–∞,
–∏ –Ω—É–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å, —á—Ç–æ –ø–æ–¥–æ–±–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –º–æ–∂–µ—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –æ—à–∏–±–∫–æ–π.

–ü–æ—ç—Ç–æ–º—É –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –Ω–∞—à–µ–π –º–æ–¥–µ–ª–∏ –±—É–¥–µ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º `Result<T>`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏–±–æ –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–∏–ø–∞ `T`, –ª–∏–±–æ –æ—à–∏–±–∫—É.

## –ö–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã

–§—å—é—á–∏, —Ç.–µ. —Å—Ç–æ—è—â–∏–µ –∑–∞ –Ω–∏–º–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –º—ã –±—É–¥–µ–º –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–º —Å—Ç–∏–ª–µ:

```cpp
futures::Future<Response> Hedge(Request request) {
  // primary ‚Äì —Ñ—å—é—á–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∞—è —É–¥–∞–ª–µ–Ω–Ω—ã–π –≤—ã–∑–æ–≤
  auto primary = Rpc(request);

  auto backup = futures::After(99ms) | futures::FlatMap([request](Unit) {
    return Rpc(request);
  });
  
  return futures::First(std::move(primary), std::move(backup));
}
``` 

–ù–∞ —ç—Ç–æ–º –Ω–µ–±–æ–ª—å—à–æ–º –ø—Ä–∏–º–µ—Ä–µ —Å —Ö—ç–¥–∂–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–æ–≤ (—Å–º. [Tail at Scale](https://www.barroso.org/publications/TheTailAtScale.pdf)) —Ö–æ—Ä–æ—à–æ –≤–∏–¥–Ω—ã –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∫ concurrency:

–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –æ–ø–∏—Å—ã–≤–∞–µ—Ç _—á—Ç–æ_ –∏ _–∫–æ–≥–¥–∞_ –æ–Ω —Ö–æ—á–µ—Ç —Å–¥–µ–ª–∞—Ç—å, –∞ –∑–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —ç—Ç–æ–≥–æ –ø–ª–∞–Ω–∞ (–∏ –∑–∞ –≤—Å—é —Å–æ–ø—Ä—è–∂–µ–Ω–Ω—É—é —Å –Ω–∏–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é) –æ—Ç–≤–µ—á–∞—é—Ç –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã.

–ú–µ–Ω—è–µ—Ç—Å—è –º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å concurrency: —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –¥—É–º–∞–µ—Ç –Ω–µ –ø—Ä–æ —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ —Ä–∞–∑–¥–µ–ª—è–µ–º–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é, —Ç.–µ. –Ω–µ –ø—Ä–æ control flow, –∞ –ø—Ä–æ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ "—Ç–µ–∫—É—Ç" –æ—Ç –ø—Ä–æ–¥—å—é—Å–µ—Ä–æ–≤ –∫ –∫–æ–Ω—Å—å—é–º–µ—Ä–∞–º, —Ç.–µ. –ø—Ä–æ data flow.

–°–º. üî• [Your Server as a Function](https://monkey.org/~marius/funsrv.pdf).

## –ú–æ–¥–µ–ª—å

–§—å—é—á–∏ ‚Äì –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç —Ü–µ–ø–æ—á–∫–∏ –∑–∞–¥–∞—á –∏–ª–∏, –≤ –æ–±—â–µ–º —Å–ª—É—á–∞–µ, –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

–û–ø–µ—Ä–∞—Ü–∏–∏:

- _–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã_ (`Contract`, `Submit`, `Value`, ...) —Å—Ç—Ä–æ—è—Ç —Ñ—å—é—á–∏ / –æ—Ç–∫—Ä—ã–≤–∞—é—Ç —Ü–µ–ø–æ—á–∫–∏,
- _–∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã_ (`Map`, `AndThen`, `OrElse`, ...) –ø–æ–ª—É—á–∞—é—Ç —Ñ—å—é—á–∏ –Ω–∞ –≤—Ö–æ–¥, –ø–æ–≥–ª–æ—â–∞—é—Ç –∏—Ö –∏ —Å—Ç—Ä–æ—è—Ç –Ω–æ–≤—ã–µ —Ñ—å—é—á–∏ / –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ü–µ–ø–æ—á–∫–∏,
- _—Ç–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä—ã_ (`Get`, `Detach`) –ø–æ–≥–ª–æ—â–∞—é—Ç —Ñ—å—é—á–∏ / –∑–∞–≤–µ—Ä—à–∞—é—Ç —Ü–µ–ø–æ—á–∫–∏.

_–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã_ –º–æ–¥–µ–ª–∏—Ä—É—é—Ç –ø—Ä–æ–¥—å—é—Å–µ—Ä–æ–≤, _—Ç–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä—ã_ ‚Äì –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–≤.

–§—å—é—á–∏ ‚Äì _–ª–∏–Ω–µ–π–Ω—ã–µ_:
- —Ñ—å—é—á–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞,
- –∫–∞–∂–¥–∞—è —Ñ—å—é—á–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–≥–ª–æ—â–µ–Ω–∞ —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–æ–º –∏–ª–∏ —Ç–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä–æ–º.

## –ü—Ä–∏–º–µ—Ä

```cpp
void FuturesExample() {
  using namespace exe;
  
  executors::ThreadPool pool{4};
  pool.Start();
  
  Result<int> r = futures::Value(1)  // <- –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, –Ω–∞—á–∏–Ω–∞–µ—Ç —Ü–µ–ø–æ—á–∫—É
      | futures::Via(pool) 
      | futures::AndThen([](int v) {  // <- –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä
          fmt::println("{}", v);
          return result::Ok(v + 1);
        }) 
      | futures::AndThen([](int v) -> Result<int> {
          return v * 2;
        })
      | futures::OrElse([](Error) {
          return result::Ok(7);  // fallback
        })  
      | futures::Get();  // <- —Ç–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä, –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ü–µ–ø–æ—á–∫—É
  
  fmt::println("{}", *r);  // –ü–µ—á–∞—Ç–∞–µ—Ç 4
  
  pool.Stop();
}
```

–ë–æ–ª—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ ‚Äì –≤ [play/main.cpp](play/main.cpp)


## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `exe/futures`

- `types` ‚Äì —Ç–∏–ø—ã
- `make` ‚Äì –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã
- `combine` ‚Äì –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã
  - `seq` ‚Äì –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è
  - `par` ‚Äì –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è
- `terminate` ‚Äì —Ç–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä—ã
- `syntax` ‚Äì –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤

## –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã

–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã ‚Äì —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ–Ω—Å—Ç—Ä—É–∏—Ä—É—é—â–∏–µ –Ω–æ–≤—ã–µ —Ñ—å—é—á–∏.

–ö–∞—Ç–∞–ª–æ–≥ –±–∞–∑–æ–≤—ã—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤: [`futures/make`](exe/futures/make)

–§—Ä–µ–π–º–≤–æ—Ä–∫ RPC —Ä–∞—Å—à–∏—Ä–∏—Ç —ç—Ç–æ—Ç –±–∞–∑–æ–≤—ã–π –Ω–∞–±–æ—Ä –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞, –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ IO ‚Äì –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è / –∑–∞–ø–∏—Å–∏ –∏ —Ç.–¥.

---

### üëâ `Contract`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`make/contract.hpp`](exe/futures/make/contract.hpp)

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –º–µ–∂–¥—É –ø—Ä–æ–¥—å—é—Å–µ—Ä–æ–º –∏ –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–º:

```cpp
auto [f, p] = futures::Contract<int>();

// Producer
std::move(p).SetValue(7);

// Consumer
auto r = std::move(f) | futures::Get();
```

–û–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ —Å—Ç–æ—Ä–æ–Ω:

- –ü—Ä–æ–¥—å—é—Å–µ—Ä –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ñ—å—é—á—É —Å –ø–æ–º–æ—â—å—é `Set` / `SetValue` / `SetError`
- –ö–æ–Ω—Å—å—é–º–µ—Ä –¥–æ–ª–∂–µ–Ω –ø–æ—Ç—Ä–µ–±–∏—Ç—å —Ñ—å—é—á—É —Å –ø–æ–º–æ—â—å—é –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–∞ –∏–ª–∏ —Ç–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä–∞

---

### üëâ `Submit`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`make/submit.hpp`](exe/futures/make/submit.hpp)

–§—å—é—á–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∞—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤ –ø—É–ª–µ –ø–æ—Ç–æ–∫–æ–≤.

–õ—è–º–±–¥–∞, –ø–µ—Ä–µ–¥–∞–Ω–Ω–∞—è –≤ `Submit`, –¥–æ–ª–∂–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `Result<T>`

```cpp
auto f = futures::Submit(pool, [] {
  return result::Ok(7);  // –£–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ Result
);
```

---

### üëâ `Value`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`make/value.hpp`](exe/futures/make/value.hpp)

–§—å—é—á–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∞—è –≥–æ—Ç–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.

```cpp
auto f = futures::Value(7);
```

---

### üëâ `Failure`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`make/failure.hpp`](exe/futures/make/fail.hpp)

–§—å—é—á–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∞—è –≥–æ—Ç–æ–≤—É—é –æ—à–∏–±–∫—É.

```cpp
auto f = futures::Failure<int>(TimeoutError());
```

---

### üëâ `Just`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`make/just.hpp`](exe/futures/make/just.hpp)

–§—å—é—á–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∞—è –≥–æ—Ç–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–∏–ø–∞ [`Unit`](exe/result/types/unit.hpp).

```cpp
auto f = futures::Just()
    | futures::Via(pool) 
    | futures::AndThen([](Unit) {
        return result::Ok(42);
      });
```

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è, –º–æ–¥–µ–ª–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é `Future<Unit>`:

–§—å—é—á–∏ ‚Äì —ç—Ç–æ –±—É–¥—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è, –Ω–æ –∑–Ω–∞—á–µ–Ω–∏–π —Ç–∏–ø–∞ `void` –Ω–µ –±—ã–≤–∞–µ—Ç, –∑–Ω–∞—á–∏—Ç –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏ –±—É–¥—É—â–∏—Ö `void`-–æ–≤.

## –ö–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã

–ö–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã ‚Äì —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—É—á–∞—é—Ç —Ñ—å—é—á–∏ –Ω–∞ –≤—Ö–æ–¥ (–ø–æ—Ç—Ä–µ–±–ª—è—é—Ç –∏—Ö) –∏ —Å—Ç—Ä–æ—è—Ç –Ω–æ–≤—ã–µ —Ñ—å—é—á–∏.

### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è

–ö–∞—Ç–∞–ª–æ–≥: [`futures/combine/seq`](exe/futures/combine/seq)

#### Pipeline operator

–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è —Ñ—å—é—á –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –æ–ø–µ—Ä–∞—Ç–æ—Ä `|` (_pipeline operator_). 

–û–ø–µ—Ä–∞—Ç–æ—Ä –Ω–µ –∏–º–µ–µ—Ç –ø—Ä—è–º–æ–≥–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∫ —Ñ—å—é—á–∞–º, –æ–Ω —Ä–µ—à–∞–µ—Ç –±–æ–ª–µ–µ –æ–±—â—É—é –∑–∞–¥–∞—á—É: —É–ø—Ä–æ—Å—Ç–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ —Ü–µ–ø–æ—á–µ–∫ –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π, –≥–¥–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–π –≤—ã–∑–æ–≤ –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥ –≤—ã—Ö–æ–¥ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ. 

–í—ã—Ä–∞–∂–µ–Ω–∏–µ `f(a) | h(x, y)` –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º `|` –≤ `h(f(a), x, y)`

–ü—Ä–∏–º–µ—Ä –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤ –°++ ‚Äì [`ranges`](https://en.cppreference.com/w/cpp/ranges)

–ü–æ–¥–¥–µ—Ä–∂–∫–∞ `|` –¥–ª—è —Ñ—å—é—á: [futures/syntax/pipe.hpp](exe/futures/syntax/pipe.hpp)

##### References

–° –ø–æ–º–æ—â—å—é –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ `|` –º—ã —ç–º—É–ª–∏—Ä—É–µ–º –æ–ø–µ—Ä–∞—Ç–æ—Ä `|>`:

- [OCaml] [Pipelining](https://cs3110.github.io/textbook/chapters/hop/pipelining.html)
- [JavaScript] [Pipe Operator (|>) for JavaScript](https://github.com/tc39/proposal-pipeline-operator/)
- [C++] [Exploring the Design Space for a Pipeline Operator](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2672r0.html)

---

#### üëâ `Map` 

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`combine/seq/map.hpp`](exe/futures/combine/seq/map.hpp)

–°–∏–≥–Ω–∞—Ç—É—Ä–∞: `Future<T>` ‚Üí (`T` ‚Üí `U`) ‚Üí `Future<U>` ([–Ω–æ—Ç–∞—Ü–∏—è](https://www.haskell.org/tutorial/functions.html) –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∞ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —è–∑—ã–∫–æ–≤)

–ö–æ–º–±–∏–Ω–∞—Ç–æ—Ä `Map`:
- –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (_–º—ç–ø–ø–µ—Ä_) –∫ –∑–Ω–∞—á–µ–Ω–∏—é –≤—Ö–æ–¥–Ω–æ–π —Ñ—å—é—á–∏, –µ—Å–ª–∏ —Ç–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ, –∏–ª–∏
- –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É, –Ω–µ –≤—ã–∑—ã–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –≤—Ö–æ–¥–Ω–∞—è —Ñ—å—é—á–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π.

```cpp
auto f = futures::Value(1) | futures::Map([](int v) {
  return v + 1;
});
```

–ö–æ–º–±–∏–Ω–∞—Ç–æ—Ä `Map` (–∫–∞–∫ –∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä) –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ —Ñ—å—é—á–µ –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è –±—É–¥—É—â–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞, –æ–Ω –ª–∏—à—å –ø–ª–∞–Ω–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—Ö–æ–¥–Ω–æ–π —Ñ—å—é—á–∏ –∏ —Å—Ç—Ä–æ–∏—Ç –Ω–æ–≤—É—é (–≤—ã—Ö–æ–¥–Ω—É—é) —Ñ—å—é—á—É.

---

#### üëâ `AndThen` / `OrElse`

–ó–∞–≥–æ–ª–æ–≤–∫–∏:
- [`combine/seq/and_then.hpp`](exe/futures/combine/seq/and_then.hpp)
- [`combine/seq/or_else.hpp`](exe/futures/combine/seq/or_else.hpp)  

–°–∏–≥–Ω–∞—Ç—É—Ä–∞:
- `AndThen`: `Future<T>`  ‚Üí (`T` ‚Üí `Result<U>`) ‚Üí `Future<U>`
- `OrElse`: `Future<T>` ‚Üí (`Error` ‚Üí `Result<T>`) ‚Üí `Future<T>`

–ö–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã `AndThen` / `OrElse` —Ä–∞–∑–¥–µ–ª—è—é—Ç —É—Å–ø–µ—à–Ω—ã–π –ø—É—Ç—å / fallback –≤ —Ü–µ–ø–æ—á–∫–µ: 
- `AndThen` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏—è—Ö, 
- `OrElse` ‚Äì —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—à–∏–±–∫–∞—Ö.

```cpp
auto f = futures::Failure<int>(TimeoutError()) | 
    | futures::AndThen([](int v) {
        return result::Ok(v + 1);
      })
    | futures::OrElse([](Error) {
        return result::Ok(7);  // Fallback
      });
```

–ù–µ—Ç—Ä—É–¥–Ω–æ –∑–∞–º–µ—Ç–∏—Ç—å, —á—Ç–æ `AndThen` / `OrElse` ‚Äì —ç—Ç–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–æ–≥ –¥–ª—è –±–ª–æ–∫–æ–≤ `try` / `catch`.

---

#### üëâ `Via`

##### –ì–æ–Ω–∫–∞

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–∏–º–µ—Ä:

```cpp
// –ì–æ–Ω–∫–∞ –º–µ–∂–¥—É –ø—Ä–æ–¥—å—é—Å–µ—Ä–æ–º –∏ –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–º
auto f = futures::Submit(pool, [] { return result::Ok(7); })
    | futures::Map([](int v) { return v + 1; });
```

–ü–æ—Ç–æ–∫, –≤ –∫–æ—Ç–æ—Ä–æ–º –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –º—ç–ø–ø–µ—Ä, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–≥–æ, –∫–∞–∫ —É–ø–æ—Ä—è–¥–æ—á–∞—Ç—Å—è –ø—Ä–∏ —Ä–∞–Ω–¥–µ–≤—É
- –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—å—é—á–∏ –≤ –ø—É–ª–µ –ø–æ—Ç–æ–∫–æ–≤ –∏ 
- –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–µ `Map`.

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –ø–ª–∞–Ω–∏—Ä—É—é—â–∏–π —Å –ø–æ–º–æ—â—å—é —Ñ—å—é—á —Ü–µ–ø–æ—á–∫—É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π, 
–¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞ —Ç–µ–º, –≤ –∫–∞–∫–æ–º –ø–æ—Ç–æ–∫–µ (–∞ –≤–µ—Ä–Ω–µ–µ, —ç–∫–∑–µ–∫—É—Ç–æ—Ä–µ) –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –∫–∞–∂–¥—ã–π –µ–µ —à–∞–≥.

–¢–∞–∫–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–∞–µ—Ç –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä `Via`: 

```cpp
auto f = futures::Submit(pool, [] { return result::Ok(7); })
    | futures::Via(pool)  // <- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —ç–∫–∑–µ–∫—É—Ç–æ—Ä –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è
    | futures::AndThen([](int value) {
        // –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤ –ø—É–ª–µ –ø–æ—Ç–æ–∫–æ–≤ `pool`
        fmt::println("{}", value);
        return result::Ok()
      });
```

–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —á–µ—Ä–µ–∑ `Via` —ç–∫–∑–µ–∫—É—Ç–æ—Ä **–Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è** –ø–æ —Ü–µ–ø–æ—á–∫–µ (–ø–æ–∫–∞ –Ω–µ –≤—Å—Ç—Ä–µ—Ç–∏—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä –∏–ª–∏ –Ω–æ–≤—ã–π `Via`).

##### State

–ú–æ–∂–Ω–æ –∑–∞–º–µ—Ç–∏—Ç—å, —á—Ç–æ `Via` ‚Äì —ç—Ç–æ –º—É—Ç–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è, –∫–æ—Ç–æ—Ä–∞—è "–ø—Ä–æ—Å–æ—á–∏–ª–∞—Å—å" –≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å.

---

#### üëâ `Flatten`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`combine/seq/flatten.hpp`](exe/futures/combine/seq/flatten.hpp)

–°–∏–≥–Ω–∞—Ç—É—Ä–∞: `Future<Future<T>>` ‚Üí `Future<T>`

"–£–ø–ª–æ—â–∞–µ—Ç" –≤–ª–æ–∂–µ–Ω–Ω—É—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å:

```cpp
futures::Future<int> f = futures::Submit(pool, [&pool]() -> Result<Future<int>> {
  return futures::Submit(pool, [] {
    return result::Ok(7);
  })
}) | futures::Flatten();
```

---

#### üëâ `FlatMap`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`combine/seq/flat_map.hpp`](exe/futures/combine/seq/flat_map.hpp)

–°–∏–≥–Ω–∞—Ç—É—Ä–∞: `Future<T>` ‚Üí (`T` ‚Üí `Future<U>`) ‚Üí `Future<U>`

–ö–æ–º–±–∏–Ω–∞—Ü–∏—è `Map` + `Flatten`. –ü–ª–∞–Ω–∏—Ä—É–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ü–µ–ø–æ—á–∫–∏ –∑–∞–¥–∞—á.

```cpp
futures::Future<int> f = futures::Submit(pool, [] {
  return Ok(1);
}) | futures::FlatMap([&pool](int v) {
  return futures::Submit(pool, [v] {
    return result::Ok(v + 1);
  });
});   
```

##### –ú–æ–Ω–∞–¥—ã

–§—å—é—á–∏ —Å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º `Value` –∏ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–æ–º `FlatMap` –æ–±—Ä–∞–∑—É—é—Ç [–º–æ–Ω–∞–¥—É](https://wiki.haskell.org/All_About_Monads#The_Monad_class).

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è

–ö–∞—Ç–∞–ª–æ–≥: [`combine/par`](exe/futures/combine/par)

---

#### üëâ `First`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`combine/par/first.hpp`](exe/futures/combine/par/first.hpp)

–§—å—é—á–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∞—è –ø–µ—Ä–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ / –ø–æ—Å–ª–µ–¥–Ω—é—é –æ—à–∏–±–∫—É –¥–≤—É—Ö —Ñ—å—é—á.

```cpp
auto timeout = futures::After(1s) 
    | futures::Map([](Unit) -> Result<int> {
        return result::Err(TimeoutError());
      });

auto compute = futures::Submit(pool, [] {
  return result::Ok(7);
})

// –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å —Ç–∞–π–º–∞—É—Ç–æ–º, –º–æ–∂–Ω–æ –ø–æ—Å–∞—Ö–∞—Ä–∏—Ç—å –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–æ–º `WithTimeout`
auto first = futures::First(std::move(compute), std::move(timeout));
```

---

#### üëâ `Both` / `All`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`combine/par/all.hpp`](exe/futures/combine/par/all.hpp)

–§—å—é—á–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∞—è –æ–±–∞ (–≤—Å–µ) –∑–Ω–∞—á–µ–Ω–∏—è / –ø–µ—Ä–≤—É—é –æ—à–∏–±–∫—É —Ñ—å—é—á, –ø–æ–¥–∞–Ω–Ω—ã—Ö –Ω–∞ –≤—Ö–æ–¥:

```cpp
auto f = futures::Submit(pool, [] { return result::Ok(1); });
auto g = futures::Submit(pool, [] { return result::Ok(2); });

auto both = futures::Both(std::move(f), std::move(g));

// –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –æ–∂–∏–¥–∞–µ–º –¥–≤—É—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
auto r = std::move(both) | futures::Get();
// –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ (`std::tuple`)
auto [x, y] = r.value();
```

–°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∞ —Ñ—å—é—á–∏ `both` –Ω–µ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ä–∞—Å–ø–∞–∫–æ–≤–∫–µ
–¥–≤—É—Ö —Ñ—å—é—á `f` –∏ `g`: –µ—Å–ª–∏ –≤—Ç–æ—Ä–∞—è —Ñ—å—é—á–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å –æ—à–∏–±–∫–æ–π, —Ç–æ –æ–∂–∏–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–π –±—É–¥–µ—Ç –ø—Ä–µ—Ä–≤–∞–Ω–æ.

---

#### –≠–∫–∑–µ–∫—É—Ç–æ—Ä—ã

–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã **—Å–±—Ä–∞—Å—ã–≤–∞—é—Ç** —ç–∫–∑–µ–∫—É—Ç–æ—Ä –¥–æ `Inline`, —Ç–∞–∫ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω —è–≤–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ–≥–æ –ø–æ—Å–ª–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —Ü–µ–ø–æ—á–µ–∫.

## –¢–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä—ã

_–¢–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä—ã_ –∑–∞–≤–µ—Ä—à–∞—é—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ü–µ–ø–æ—á–∫–∏ / –≥—Ä–∞—Ñ—ã.

–ö–∞—Ç–∞–ª–æ–≥: [`futures/terminate`](exe/futures/terminate)

---

### üëâ `Get`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`terminate/get.hpp`](exe/futures/terminate/get.hpp)

–¢–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä `Get` –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â–∏–π –ø–æ—Ç–æ–∫ –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:

```cpp
// –ü–ª–∞–Ω–∏—Ä—É–µ–º –∑–∞–¥–∞—á—É –≤ –ø—É–ª –ø–æ—Ç–æ–∫–æ–≤ –∏ –¥–æ–∂–∏–¥–∞–µ–º—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
Result<int> r = futures::Submit(pool, [] {
  return result::Ok(7);
}) | futures::Get();
```

–ò–Ω–∞—á–µ –≥–æ–≤–æ—Ä—è, `Get` —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ "—Ä–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç" `Future` –≤ `Result`.

---

### üëâ `Detach`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`terminate/detach.hpp`](exe/futures/terminate/detach.hpp)

`Future` –∞–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞–Ω–∞ `[[nodiscard]]` –∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —è–≤–Ω–æ –ø–æ–≥–ª–æ—â–µ–Ω–∞ –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–º. 

–¢–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä `Detach` –ø–æ–≥–ª–æ—â–∞–µ—Ç —Ñ—å—é—á—É –∏ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –µ–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

```cpp
// –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –≤ –ø—É–ª–µ –Ω–∞—Å –Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç
futures::Submit(pool, [] {
  /* ... */
}) | futures::Detach();
```

### –û–ø–µ—Ä–∞—Ç–æ—Ä—ã

–í [`futures/syntax`](exe/futures/syntax) —Å–æ–±—Ä–∞–Ω—ã –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –¥–ª—è —Ñ—å—é—á:

- `f | c` –æ–∑–Ω–∞—á–∞–µ—Ç `c.Pipe(f)`
- `f or g` –æ–∑–Ω–∞—á–∞–µ—Ç `First(f, g)`
- `f + g` –æ–∑–Ω–∞—á–∞–µ—Ç `Both(f, g)`

#### –ü—Ä–∏–º–µ—Ä

```cpp
// –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –¥–æ–∂–∏–¥–∞–µ–º—Å—è –ø–µ—Ä–≤–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
auto r = (std::move(compute) or std::move(timeout)) | futures::Get();
```

## `Result`

`Result<T>` ‚Äì —ç—Ç–æ alias –¥–ª—è `tl::expected<T, E>`, –≥–¥–µ `E` = `std::error_code`.

- https://github.com/TartanLlama/expected.
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://tl.tartanllama.xyz/en/latest/api/expected.html)

–ú—ã —Ñ–∏–∫—Å–∏—Ä—É–µ–º —Ç–∏–ø –æ—à–∏–±–∫–∏ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã, –≤ —Ö–æ—Ä–æ—à–µ–º —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–µ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–≤–æ–±–æ–¥–∞ –≤ –≤—ã–±–æ—Ä–µ —Ç–∏–ø–∞ `E`.

### –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã

#### `Ok`

–ü–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å –≤ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ –ª—è–º–±–¥—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —Ç–∏–ø:

```cpp
auto f = futures::Value(7) | futures::AndThen([](int v) {
  return result::Ok(v + 1);
);
```

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç:

```cpp
auto f = futures::Value(7) | futures::AndThen([](int v) -> Result<int> {
  return v + 1;   // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É–ø–∞–∫–æ–≤–∫–∞
);
```

#### `Err`

```cpp
// Status ‚Äì —ç—Ç–æ alias –¥–ª—è Result<Unit>
auto f = futures::Just() | futures::AndThen([](Unit) -> Status {
  return result::Err(TimeoutError());  // –¢–∏–ø –∑–Ω–∞—á–µ–Ω–∏—è –≤—ã–≤–æ–¥–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
});
```

## –ó–∞–¥–∞–Ω–∏–µ

1) –†–µ–∞–ª–∏–∑—É–π—Ç–µ `futures::Contract` + `futures::Get` —Å –ø–æ–º–æ—â—å—é wait-free —Ä–∞–Ω–¥–µ–≤—É –∏ –ø–æ–¥–ø–∏—Å–∫–∏ —Å –∫–æ–ª–ª–±—ç–∫–æ–º
2) [–ë–æ–Ω—É—Å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å] –ü—Ä–æ—á—Ç–∏—Ç–µ —Å—Ç–∞—Ç—å—é [Your Server as a Function](https://monkey.org/~marius/funsrv.pdf)
3) –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ñ—å—é—á–∏
   1) –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã
   2) –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã
   3) –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã
4) [–ë–æ–Ω—É—Å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å] [–ü–æ–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å —è–∑—ã–∫–æ–º Haskell](https://www.haskell.org/tutorial/), –º—ã –∫ –Ω–µ–º—É –µ—â–µ –≤–µ—Ä–Ω–µ–º—Å—è
5) [–ë–æ–Ω—É—Å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å] –ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ –ª—è–º–±–¥—ã, –ø–æ–ª—É—á–∞—é—â–∏–µ –Ω–∞ –≤—Ö–æ–¥ / –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–µ `void`

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### `Future` ‚Äì –∑–Ω–∞—á–µ–Ω–∏–µ

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥–æ–≤ —É –∫–ª–∞—Å—Å–∞ `Future`, –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ñ—å—é—á–∞–º–∏ –∫–∞–∫ —Å–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏, —Ç.–µ. –ø–µ—Ä–µ–¥–∞–µ—Ç (—Ç–æ—á–Ω–µ–µ, –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç)
–≤ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã –∏ —Ç–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä—ã.

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —ç—Ç–æ–º –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å —Å–ª—É–∂–µ–±–Ω—ã–µ –º–µ—Ç–æ–¥—ã `Future`.

### –ö–æ–ª–ª–±—ç–∫–∏

–ó–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º `Get`, –≤ —Ñ—å—é—á–∞—Ö –Ω–∏–≥–¥–µ –Ω–µ—Ç –±–ª–æ–∫–∏—Ä—É—é—â–µ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è!

–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –º–µ—Ö–∞–Ω–∏–∫–∞ –≤—Å–µ—Ö –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–æ–≤ –∏ —Ç–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä–æ–≤ ‚Äì –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ä–∞–∑—É–ª—å—Ç–∞—Ç —Å –ø–æ–º–æ—â—å—é –∫–æ–ª–ª–±—ç–∫–∞.

–ù–∞–ø—Ä–∏–º–µ—Ä, 
- –≤ `Map` –∫–æ–ª–ª–±—ç–∫ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç –∑–∞–ø—É—Å–∫ –º—ç–ø–ø–µ—Ä–∞ –≤ —ç–∫–∑–µ–∫—É—Ç–æ—Ä,
- –≤ `Get` –∫–æ–ª–ª–±—ç–∫ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –±—É–¥–∏—Ç –∂–¥—É—â–∏–π –ø–æ—Ç–æ–∫,
- –≤ `First` ‚Äì "–≥–æ–Ω—è–µ—Ç—Å—è" —Å –¥—Ä—É–≥–∏–º –∫–æ–ª–ª–±—ç–∫–æ–º –∑–∞ –ø—Ä–∞–≤–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—ã—Ö–æ–¥–Ω—É—é —Ñ—å—é—á—É.

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

–§—å—é—á–∞–º –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–∑–∞–∏–º–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –≤—Å–µ —Ç–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä—ã –∏ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã –≤
–∑–∞–¥–∞—á–µ –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ wait-free.

## References

### Futures

- [Twitter Futures](https://twitter.github.io/finagle/guide/Futures.html), [Your Server as a Function](https://monkey.org/~marius/funsrv.pdf)
- [Futures for C++11 at Facebook](https://engineering.fb.com/2015/06/19/developer-tools/futures-for-c-11-at-facebook/), [Folly Futures](https://github.com/facebook/folly/blob/main/folly/docs/Futures.md)
- [–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏](https://habr.com/ru/companies/jugru/articles/446562/)

### Errors

- [The Error Model](https://joeduffyblog.com/2016/02/07/the-error-model/)

### Haskell

- [A Gentle Introduction to Haskell](https://www.haskell.org/tutorial/)

### Monads

- [All About Monads](https://wiki.haskell.org/All_About_Monads)
- [Monads for functional programming](https://homepages.inf.ed.ac.uk/wadler/papers/marktoberdorf/baastad.pdf)
- [Functors, Applicatives, And Monads In Pictures](https://www.adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html)
